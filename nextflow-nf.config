/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    PacBio HiFi 16S rRNA Nextflow config file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Cáº¥u hÃ¬nh pipeline xá»­ lÃ½ dá»¯ liá»‡u 16S rRNA PacBio HiFi, chá»‰ há»— trá»£ Docker & Singularity.
----------------------------------------------------------------------------------------
*/

//  ** Khai bÃ¡o tham sá»‘ Ä‘áº§u vÃ o & cáº¥u hÃ¬nh pipeline**
params {
    //  Input & Output
    input                 = null  // Tá»‡p Ä‘áº§u vÃ o (FASTQ)
    input_fasta           = null  // Tá»‡p FASTA Ä‘áº§u vÃ o (náº¿u cÃ³)
    metadata              = null  // Metadata cá»§a máº«u
    outdir                = 'results' // ThÆ° má»¥c Ä‘áº§u ra

    //  Cáº¥u hÃ¬nh phÃ¢n tÃ­ch
    trunc_qmin            = 25
    trunc_rmin            = 0.75
    max_ee                = 2
    min_len               = 50
    dada_ref_taxonomy     = "silva=138"  // CSDL phÃ¢n loáº¡i
    diversity_depth       = 500  // NgÆ°á»¡ng rarefaction diversity

    //  Tuá»³ chá»n khÃ¡c
    save_intermediates    = false
    skip_multiqc          = false
    skip_report           = false
}

//  ** TÃ­ch há»£p `base.config` Ä‘á»ƒ káº¿ thá»«a cáº¥u hÃ¬nh tÃ i nguyÃªn**
includeConfig 'conf/base.config'

//  ** Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng cháº¡y (chá»‰ Docker & Singularity)**
profiles {
    docker {
        docker.enabled          = true
        singularity.enabled     = false
        conda.enabled           = false
        podman.enabled          = false
        docker.runOptions       = '-u $(id -u):$(id -g)'
    }
    singularity {
        singularity.enabled     = true
        singularity.autoMounts  = true
        conda.enabled           = false
        docker.enabled          = false
    }
}

//  ** Cáº¥u hÃ¬nh theo dÃµi pipeline (timeline, report, trace, dag)**
def trace_timestamp = new java.util.Date().format('yyyy-MM-dd_HH-mm-ss')

timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file    = "${params.outdir}/pipeline_info/pipeline_dag_${trace_timestamp}.html"
}

// ğŸ“Œ **Manifest pipeline**
manifest {
    name            = 'pacbio-16s-hifi'
    author          = "Your Name"
    homePage        = 'https://github.com/your-repo/pacbio-16s-hifi'
    description     = "Pipeline xá»­ lÃ½ dá»¯ liá»‡u 16S rRNA tá»« PacBio HiFi"
    mainScript      = 'main.nf'
    nextflowVersion = '!>=24.04.2'
    version         = '1.0.0'
}

// ğŸ› ï¸ **Load cÃ¡c tá»‡p config khÃ¡c náº¿u cáº§n**
includeConfig 'conf/modules.config'
includeConfig 'conf/ref_databases.config'

// ğŸš¨ **Cáº¥u hÃ¬nh Bash trong Nextflow Ä‘á»ƒ trÃ¡nh lá»—i**
process.shell = """
bash
set -e  # Dá»«ng náº¿u cÃ³ lá»—i
set -u  # BÃ¡o lá»—i náº¿u biáº¿n chÆ°a Ä‘Æ°á»£c Ä‘áº·t
set -o pipefail  # Giá»¯ tráº¡ng thÃ¡i lá»—i cá»§a lá»‡nh trong pipeline
"""
